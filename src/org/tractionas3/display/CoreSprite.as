/** * @version 1.0 * @author David Dahlstroem | daviddahlstroem.com *  *  * Copyright (c) 2009 David Dahlstroem | daviddahlstroem.com *  * Permission is hereby granted, free of charge, to any person obtaining a copy * of this software and associated documentation files (the "Software"), to deal * in the Software without restriction, including without limitation the rights * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell * copies of the Software, and to permit persons to whom the Software is * furnished to do so, subject to the following conditions: *  * The above copyright notice and this permission notice shall be included in * all copies or substantial portions of the Software. *  * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN * THE SOFTWARE. * */package org.tractionas3.display {	import org.tractionas3.core.Destructor;	import org.tractionas3.core.interfaces.ICoreInterface;	import org.tractionas3.core.interfaces.IDestructable;	import org.tractionas3.reflection.stringify;	import flash.display.DisplayObject;	import flash.display.Sprite;	import flash.events.Event;	import flash.events.IEventDispatcher;	import flash.filters.BitmapFilter;	import flash.utils.getQualifiedClassName;	/**	 * CoreSprite is the core DisplayObject class of the TractionAS3 API.	 */	public class CoreSprite extends Sprite implements ICoreInterface, IEventDispatcher	{		private var _interactive:Boolean = true;		private var _filters:Array;				/**		 * Creates a new CoreSprite object.		 */		public function CoreSprite()		{			super();						addEventListener(Event.ADDED_TO_STAGE, onAddedToStageInternal);			_filters = [];		}		/**		 * @inheritDoc		 */		public function destruct(deepDestruct:Boolean = false):void		{			if(deepDestruct)			{				destructChildren(deepDestruct);			}						removeEventListener(Event.ADDED_TO_STAGE, onAddedToStageInternal);						removeEventListener(Event.REMOVED_FROM_STAGE, onRemovedFromStageInternal);						_filters = null;						_interactive = false;						Destructor.destruct(this, deepDestruct);		}		/**		 * @inheritDoc		 */		public function listDestructableProperties():Array		{			return ["alpha", "buttonMode", "cacheAsBitmap", "contextMenu", "doubleClickEnabled", "dropTarget", "filters", "focusRect", "graphics", "height", "hitArea", "mask", "mouseChildren", "mouseEnabled", "opaqueBackground", "rotation", "scale9Grid", "scrollRect", "scaleX", "scaleY", "tabIndex", "tabEnabled", "useHandCursor", "visible", "width", "x", "y"];		}		/**		 * Iterates through all the children in the displaylist and calls the <code>destruct()</code> method on them, them removes them from the display list.		 * Only applies to children implementing the <code>org.tractionas3.core.Destructable</code> interface.		 * 		 * @see org.tractionas3.core.Destructable		 */		public function destructChildren(deepDestruct:Boolean = false):void		{			for(var i:int = 0;i < numChildren; ++i)			{				if(getChildAt(i) is IDestructable)				{					ICoreInterface(getChildAt(i)).destruct(deepDestruct);				}			}						removeChildren();		}		/**		 * Returns a string representation of the CoreSprite instance.		 * Part of the string returned is a display display hierarchy indication.		 */		override public function toString():String		{			var tParent:DisplayObject = parent;						var hstr:String = "";						var n:String;						var i:uint = 0;						while(tParent)			{				if(i > 0) hstr += " -> ";								n = (tParent.name == null) ? "No name" : tParent.name;								hstr += getQualifiedClassName(tParent).split("::")[1] + "(" + n + ")";								tParent = tParent.parent;								++i;			}						if(i == 0) hstr = "(No parent)";						return stringify(this) + "[display hierarchy=" + hstr + "]";		}		/**		 * Defines the scale of the CoreSprite instance in aspect ratio 1:1.		 */		public function get scale():Number		{			return (scaleX >= scaleY) ? scaleX : scaleY;		}		public function set scale(value:Number):void		{			scaleX = scaleY = value;		}		/**		 * Defines whether the CoreSprite instance reacts to mouse.		 * Setting the this property is equal to setting <code>mouseEnabled</code> and <code>mouseChildren</code> to the same value.		 * 		 * Use <code>mouseEnabled</code> or <code>mouseChildren</code> to specifically disable mouse interaction on a		 * CoreSprite instance or CoreSprite instance children.		 */		public function get interactive():Boolean		{			return _interactive;		}		public function set interactive(value:Boolean):void		{			_interactive = mouseChildren = mouseEnabled = value;		}		/**		 * Indicates whether the CoreSprite is a child to application stage. 		 */		public function get hasStage():Boolean		{			return stage != null;		}		/**		 * Adds multiple chidren to the CoreSprite instance.		 * 		 * @param children DisplayObject instances added to CoreSprite display list.		 */		public function addChildren(...children:Array):void 		{			for (var i:int = 0;i < children.length; ++i) 			{				addChild(children[i]);			}		}		/**		 * Removes multiple children to the CoreSprite instance.		 * 		 * @param children DisplayObject instances removed to CoreSprite display list.		 * If no arguments are passed all children are removed.		 */		public function removeChildren(...children:Array):void 		{			if(children.length > 0) 			{				for (var i:int = 0;i < children.length; ++i) 				{					removeChild(children[i]);				}			} 			else 			{				var numChildren:int = numChildren;								for (var ii:int = 0;ii < numChildren; ++ii) 				{					removeChildAt(0);				}                       			}		}		/**		 * Called when the CoreSprite instance is added to stage.		 * When extending CoreSprite, overriding this method will implement custom functionality.		 */		protected function onAddedToStage():void		{			return;		}		/**		 * Called when the CoreSprite instance is removed from stage.		 * When extending CoreSprite, overriding this method will implement custom functionality.		 */		protected function onRemovedFromStage():void		{			return;		}		/**		 * Dispatches an event into the event flow, <i>only</i> if event property <code>hasEventListener</code> or <code>bubbles</code> are <code>true</code>. 		 */		override public function dispatchEvent(evt:Event):Boolean 		{			if (hasEventListener(evt.type) || evt.bubbles) 			{				return super.dispatchEvent(evt);			}			return true;		}		/**		 * Registers an event listener object with an EventDispatcher object so that the listener receives notification of an event.		 * 		 * @param useWeakReference In CoreSprite class this parameter is set to <code>true</code> by default.		 * This is to more easily mark the CoreSprite instance for garbage collection.		 */		override public function addEventListener(type:String, listener:Function, useCapture:Boolean = false, priority:int = 0, useWeakReference:Boolean = true):void		{			super.addEventListener(type, listener, useCapture, priority, useWeakReference);		}		/**		 * An indexed array that contains each filter object currently associated with the CoreSprite.		 * <p />		 * CoreSprite implements a modified filter structure allowing you to add and remove any specified filter.		 * You can explicitly add or remove filters using the <code>adddFilter()</code> or <code>removeFilter()</code> methods.		 * Changing property of a filter requires an <code>updateFilters()</code> method call, however adding or removing a filter does not.		 * 		 * @see #addFilter()		 * @see #removeFilter()		 * @see #updateFilters()		 * @see #hasFilter()		 * 		 */		override public function get filters():Array		{			return _filters;		}		override public function set filters(value:Array):void		{			_filters = value;						super.filters = _filters;		}		/**		 * Adds a new filter to the CoreSprite.		 */		public function addFilter(filter:BitmapFilter):BitmapFilter		{			_filters.push(filter);						filters = _filters;						return filter;		}		/**		 * Removes specified filter from CoreSprite		 */		public function removeFilter(filter:BitmapFilter):void		{			for(var i:int = 0;i < _filters.length; ++i)			{				if(_filters[i] === filter)				{					_filters.splice(i, 1);					break;				}			}						filters = _filters;		}		/**		 * Reapplies the filters to the CoreSprite. After changing properties in filters applied to CoreSprite, call this method to update their display.		 */		public function updateFilters():void		{			filters = filters;		}		/**		 * Indicates whether specified filter is applied to CoreSprite.		 */		public function hasFilter(filter:BitmapFilter):Boolean		{			return filters.indexOf(filter) > -1;		}		/**		 * @private		 */		protected function onAddedToStageInternal(e:Event = null):void		{			onAddedToStage();						addEventListener(Event.REMOVED_FROM_STAGE, onRemovedFromStageInternal);						removeEventListener(Event.ADDED_TO_STAGE, onAddedToStageInternal);		}		/**		 * @private		 */		protected function onRemovedFromStageInternal(e:Event = null):void		{			onRemovedFromStage();						addEventListener(Event.ADDED_TO_STAGE, onAddedToStageInternal);						removeEventListener(Event.REMOVED_FROM_STAGE, onRemovedFromStageInternal);		}	}}